<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog or Cat Classifier</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 500px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px 0; }
        #result { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .loading { display: none; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dog or Cat Classifier</h1>
        <input id="photo" type="file" accept="image/*">
        <div class="loading" id="loading">Processing...</div>
        <div id="results"></div>
    </div>

    <script>
        async function loaded(reader) {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                // Step 1: Submit the prediction request
                const response = await fetch('https://ten-jampa-minima-first.hf.space/gradio_api/call/predict', {
                    method: "POST", 
                    body: JSON.stringify({ 
                        "data": [{
                            "path": reader.result,
                            "meta": {"_type": "gradio.FileData"}
                        }]
                    }),
                    headers: { "Content-Type": "application/json" }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const json = await response.json();
                const eventId = json.event_id;
                
                // Step 2: Poll for the result
                const result = await pollForResult(eventId);
                
                // Step 3: Display the result
                const label = result[0].label;
                const confidences = result[0].confidences;
                
                let html = `<br/><img src="${reader.result}" width="300"> <p><strong>Result: ${label}</strong></p>`;
                html += '<h4>Confidence Scores:</h4>';
                
                confidences.forEach(conf => {
                    const percentage = (conf.confidence * 100).toFixed(2);
                    html += `<p>${conf.label}: ${percentage}%</p>`;
                });
                
                results.innerHTML = html;
                
            } catch (error) {
                console.error('Error:', error);
                results.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        }
        
        async function pollForResult(eventId) {
            const maxAttempts = 30;
            let attempts = 0;
            
            while (attempts < maxAttempts) {
                try {
                    const response = await fetch(`https://ten-jampa-minima-first.hf.space/gradio_api/call/predict/${eventId}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const text = await response.text();
                    const lines = text.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('event: complete')) {
                            const dataLine = lines.find(l => l.startsWith('data: '));
                            if (dataLine) {
                                const jsonData = dataLine.substring(6);
                                return JSON.parse(jsonData);
                            }
                        }
                    }
                    
                    // Wait 1 second before next attempt
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    attempts++;
                    
                } catch (error) {
                    console.error('Polling error:', error);
                    attempts++;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            throw new Error('Timeout waiting for result');
        }
        
        function read() {
            const reader = new FileReader();
            reader.addEventListener('load', () => loaded(reader));
            reader.readAsDataURL(photo.files[0]);
        }
        
        photo.addEventListener('input', read);
    </script>
</body>
</html> 